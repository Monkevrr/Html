<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Launcher</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #1a0000;
            --header: #330000;
            --text: #fff;
            --muted: #ccc;
            --accent: #ff0000;
            --accentDark: #cc0000;
            --glowColor: #ff0000;
            --cardBg: #1a0000;
            --cardRadius: 15px;
            --glowSize: 20px;
            --glowStrength: 0.3;
            --fontFamily: 'Arial', sans-serif;
            --snowColor: #ffffff;
            --snowCount: 150;
            --snowSize: 3;
            --snowSpeed: 1.2;
        }

        body {
            font-family: var(--fontFamily);
            background: linear-gradient(135deg, var(--bg), #000000);
            color: var(--text);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Snow Canvas */
        #snowCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            mix-blend-mode: screen;
        }

        /* Sidebar - Now Horizontal Top Menu */
        .sidebar {
            width: 100%;
            height: auto;
            background: linear-gradient(180deg, var(--header), var(--bg));
            border-bottom: 3px solid var(--accent);
            padding: 15px 20px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }

        .sidebar-title {
            font-size: 24px;
            color: var(--accent);
            text-align: center;
            margin-right: 30px;
            text-shadow: 0 0 10px var(--accent);
            font-weight: bold;
        }

        .sidebar-item {
            position: relative;
            background: linear-gradient(145deg, var(--accentDark), var(--accent));
            border: 2px solid var(--accent);
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .sidebar-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px var(--glowColor);
            filter: brightness(1.2);
        }

        .sidebar-item.active {
            filter: brightness(1.3);
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }

        .sidebar-item.locked {
            background: linear-gradient(145deg, #666, #999);
            border-color: #999;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .sidebar-item.locked:hover {
            transform: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .lock-icon {
            margin-left: 5px;
            font-size: 14px;
        }

        /* Tooltip - Adjusted for top menu */
        .tooltip {
            position: absolute;
            left: 50%;
            top: 100%;
            transform: translateX(-50%);
            margin-top: 10px;
            background: rgba(255, 0, 0, 0.95);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.7);
            z-index: 200;
            border: 2px solid #ff6666;
        }

        .tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-bottom-color: #ff0000;
        }

        .sidebar-item:hover .tooltip {
            opacity: 1;
        }

        /* Main Content Area - Adjusted for top menu */
        .main-wrapper {
            margin-left: 0;
            margin-top: 80px;
            margin-bottom: 80px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: calc(100vh - 160px);
            padding: 20px;
        }

        /* Initial Loading Screen */
        #initial-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg), #000000);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .initial-spinner {
            position: relative;
            width: 120px;
            height: 120px;
            margin-bottom: 30px;
            perspective: 1000px;
        }

        .initial-spinner::before,
        .initial-spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid transparent;
        }

        .initial-spinner::before {
            border-top-color: var(--accent);
            border-right-color: var(--accentDark);
            animation: spin3d 1.5s linear infinite;
            box-shadow: 0 0 30px var(--accent), inset 0 0 20px var(--glowColor);
        }

        .initial-spinner::after {
            border-bottom-color: var(--glowColor);
            border-left-color: var(--accentDark);
            animation: spin3d 2s linear infinite reverse;
            box-shadow: 0 0 20px var(--accentDark);
        }

        @keyframes spin3d {
            0% { 
                transform: rotate(0deg) rotateY(0deg);
            }
            50% {
                transform: rotate(180deg) rotateY(30deg);
            }
            100% { 
                transform: rotate(360deg) rotateY(0deg);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 28px;
            color: var(--accent);
            text-shadow: 
                1px 1px 0px var(--accentDark),
                0 0 20px var(--accent),
                0 0 40px var(--glowColor);
            animation: pulse 1.5s ease-in-out infinite;
            font-weight: bold;
            letter-spacing: 2px;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1) translateZ(0);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.05) translateZ(10px);
            }
        }

        .game-count {
            font-size: 48px;
            color: var(--accent);
            margin-top: 20px;
            text-shadow: 
                0 0 30px var(--accent),
                0 0 50px var(--glowColor);
            font-weight: bold;
            letter-spacing: 3px;
            transform-style: preserve-3d;
        }

        /* Main Content */
        #main-content {
            display: none;
            width: 100%;
        }

        .content-section {
            display: none;
            width: 100%;
        }

        .content-section.active {
            display: block;
        }

        h1 {
            margin: 40px 0 30px 0;
            font-size: 48px;
            text-align: center;
            text-shadow: 2px 2px 8px var(--accent), -2px -2px 8px var(--accentDark);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 2px 2px 8px var(--accent), -2px -2px 8px var(--accentDark);
            }
            to {
                text-shadow: 2px 2px 20px var(--accent), -2px -2px 20px var(--accentDark);
            }
        }

        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 0 auto 40px auto;
            max-width: 1400px;
        }

        .game-button {
            background: linear-gradient(145deg, var(--accentDark), var(--accent));
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: var(--cardRadius);
            cursor: pointer;
            color: #fff;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .game-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .game-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .game-button:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px var(--glowColor);
        }

        .game-button span {
            position: relative;
            z-index: 1;
        }

        /* Settings Section */
        .settings-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .settings-section {
            background: var(--cardBg);
            border-radius: var(--cardRadius);
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--accent);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .settings-section h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 28px;
            text-shadow: 0 0 10px var(--accent);
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .theme-option {
            background: linear-gradient(145deg, var(--accentDark), var(--accent));
            border: 2px solid var(--accent);
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            position: relative;
        }

        .theme-option:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--glowColor);
        }

        .theme-option.selected {
            border-color: #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.6);
        }

        .theme-option.selected::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 24px;
            color: #ffff00;
        }

        .teacher-link-section {
            text-align: center;
            margin-top: 30px;
        }

        .teacher-link {
            display: inline-block;
            background: linear-gradient(145deg, var(--accentDark), var(--accent));
            color: white;
            text-decoration: none;
            padding: 20px 40px;
            border-radius: var(--cardRadius);
            font-size: 24px;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .teacher-link:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px var(--glowColor);
        }

        .shortcut-hint {
            margin-top: 15px;
            color: var(--muted);
            font-size: 16px;
        }

        /* Proxy Content */
        .proxy-message {
            text-align: center;
            font-size: 24px;
            color: var(--accent);
            margin-top: 50px;
            text-shadow: 0 0 10px var(--accent);
        }

        .proxy-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 800px;
            margin: 40px auto;
        }

        .proxy-item {
            background: linear-gradient(145deg, var(--accentDark), var(--accent));
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            cursor: pointer;
        }

        .proxy-item a {
            color: white;
            text-decoration: none;
            font-size: 20px;
            font-weight: bold;
        }

        .proxy-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px var(--glowColor);
        }

        /* Key Input Modal */
        .key-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .key-modal.show {
            display: flex;
        }

        .key-modal-content {
            background: linear-gradient(145deg, var(--bg), var(--header));
            padding: 40px;
            border-radius: 20px;
            border: 3px solid var(--accent);
            box-shadow: 0 0 50px var(--glowColor);
            text-align: center;
        }

        .key-modal-content h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 32px;
            text-shadow: 0 0 10px var(--accent);
        }

        .key-input {
            padding: 15px;
            font-size: 20px;
            border: 2px solid var(--accent);
            border-radius: 10px;
            background: #000;
            color: #fff;
            width: 300px;
            margin-bottom: 20px;
        }

        .key-submit {
            background: linear-gradient(145deg, var(--accentDark), var(--accent));
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            color: #fff;
            margin-right: 10px;
        }

        .key-cancel {
            background: linear-gradient(145deg, #666, #999);
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            color: #fff;
        }

        .key-error {
            color: var(--accent);
            margin-top: 10px;
            font-size: 16px;
        }

        /* Game Loading Overlay */
        #game-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: #fff;
            z-index: 1500;
        }

        .spinner {
            border: 8px solid var(--bg);
            border-top: 8px solid var(--accent);
            border-right: 8px solid var(--accentDark);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .bible-verse {
            max-width: 600px;
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 0, 0, 0.1);
            border-radius: 15px;
            border: 2px solid var(--accent);
        }

        .verse-text {
            font-size: 18px;
            color: #fff;
            font-style: italic;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .verse-reference {
            font-size: 16px;
            color: var(--glowColor);
            font-weight: bold;
            text-shadow: 0 0 5px var(--glowColor);
        }

        /* Game Container */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            z-index: 1000;
            padding: 20px;
        }

        #game-container:fullscreen {
            padding: 0;
        }

        #game-container:-webkit-full-screen {
            padding: 0;
        }

        #game-container:-moz-full-screen {
            padding: 0;
        }

        #game-container:-ms-fullscreen {
            padding: 0;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px 20px;
            background: var(--cardBg);
            border-radius: 10px;
        }

        #game-container:fullscreen .game-header {
            border-radius: 0;
            margin-bottom: 0;
        }

        .game-title {
            font-size: 24px;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: linear-gradient(145deg, var(--accent), var(--accentDark));
            border: none;
            padding: 10px 25px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            color: #fff;
            transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .control-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px var(--glowColor);
        }

        #game-frame {
            width: 100%;
            flex: 1;
            border: 3px solid var(--accent);
            border-radius: 15px;
            background: #000;
            box-shadow: 0 0 30px var(--glowColor);
        }

        #game-container:fullscreen #game-frame {
            border-radius: 0;
            border: none;
        }

        /* Fullscreen hint */
        .fullscreen-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 2000;
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .fullscreen-hint.show {
            display: block;
        }

        /* Clock & Battery Widget - Now at Bottom */
        #statusBar {
            position: fixed;
            bottom: 10px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 5000;
            font-size: 20px;
            color: var(--accent);
            font-weight: bold;
            text-shadow: 0 0 10px var(--accent);
        }

        #batteryWidget {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--cardBg);
            border-radius: 20px;
            border: 2px solid var(--accent);
        }

        #batteryWidget i {
            font-size: 22px;
        }

        #batteryChargingIcon {
            color: #00ff00;
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Device Info Widget - Now at Bottom Left */
        #deviceInfo {
            position: fixed;
            bottom: 10px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 5000;
            padding: 10px 20px;
            background: var(--cardBg);
            border-radius: 15px;
            border: 2px solid var(--accent);
        }

        .device-name {
            font-size: 16px;
            color: var(--accent);
            font-weight: bold;
            text-shadow: 0 0 8px var(--accent);
        }

        .managed-by {
            font-size: 13px;
            color: var(--muted);
            font-weight: normal;
            text-shadow: 0 0 5px var(--glowColor);
        }

        .device-icon {
            display: inline-block;
            margin-right: 8px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                flex-wrap: wrap;
                padding: 10px;
                gap: 10px;
            }

            .sidebar-title {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
                font-size: 20px;
            }

            .sidebar-item {
                padding: 10px 15px;
                font-size: 14px;
            }

            .main-wrapper {
                margin-top: 120px;
                padding: 10px;
            }

            h1 {
                font-size: 28px;
            }

            .tooltip {
                font-size: 11px;
            }

            #statusBar {
                flex-direction: column;
                gap: 10px;
                font-size: 16px;
                bottom: 10px;
                right: 10px;
            }

            #deviceInfo {
                bottom: 10px;
                left: 10px;
                padding: 8px 12px;
            }

            .device-name {
                font-size: 14px;
            }

            .managed-by {
                font-size: 11px;
            }

            .theme-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <!-- Snow Canvas -->
    <canvas id="snowCanvas"></canvas>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-title">Menu</div>
        <div class="sidebar-item active" onclick="switchSection('games')">
            Games
            <div class="tooltip">Games are games</div>
        </div>
        <div class="sidebar-item locked" id="proxysItem" onclick="checkProxyAccess()">
            Proxys <span class="lock-icon">üîí</span>
            <div class="tooltip">Proxys are websites that have browsers built in them</div>
        </div>
        <div class="sidebar-item" onclick="switchSection('settings')">
            Settings
            <div class="tooltip">Customize your experience</div>
        </div>
    </div>

    <!-- Main Wrapper -->
    <div class="main-wrapper">
        <!-- Initial Loading Screen -->
        <div id="initial-loader">
            <div class="initial-spinner"></div>
            <div class="loading-text">Scanning for games...</div>
            <div class="game-count" id="gameCount"></div>
        </div>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Games Section -->
            <div class="content-section active" id="gamesSection">
                <h1>Game Hub (I didn't make any of these games)</h1>
                <div class="button-container" id="gameButtons"></div>
            </div>

            <!-- Proxys Section -->
            <div class="content-section" id="proxysSection">
                <h1>Proxy Zone</h1>
                <div class="proxy-message">Welcome to the Proxy Zone! üåê</div>
                <div class="proxy-list" id="proxyList"></div>
            </div>

            <!-- Settings Section -->
            <div class="content-section" id="settingsSection">
                <h1>Settings</h1>
                <div class="settings-container">
                    <div class="settings-section">
                        <h2>üé® Theme Selection</h2>
                        <p style="color: var(--muted); margin-bottom: 15px;">Choose your favorite theme to customize the launcher's appearance:</p>
                        <div class="theme-grid" id="themeGrid"></div>
                    </div>

                    <div class="settings-section teacher-link-section">
                        <h2>üö® Quick Links</h2>
                        <p style="color: var(--muted); margin-bottom: 20px;">Need to switch screens fast?</p>
                        
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; margin-bottom: 10px; color: var(--text); font-weight: bold;">Customize Link URL:</label>
                            <input type="url" id="teacherLinkInput" class="link-input" placeholder="https://classroom.google.com" style="width: 100%; max-width: 500px; padding: 12px; font-size: 16px; border: 2px solid var(--accent); border-radius: 10px; background: var(--cardBg); color: var(--text);">
                            <button onclick="saveTeacherLink()" style="margin-top: 10px; background: linear-gradient(145deg, var(--accentDark), var(--accent)); border: none; padding: 12px 30px; font-size: 16px; font-weight: bold; border-radius: 10px; cursor: pointer; color: #fff; transition: transform 0.2s;">
                                üíæ Save Link
                            </button>
                        </div>

                        <a href="https://classroom.google.com" class="teacher-link" id="teacherLink" target="_blank">
                            Teacher Coming!
                        </a>
                        <div class="shortcut-hint">
                            Press <strong>Ctrl + 1</strong> to open this link instantly
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Info Widget -->
    <div id="deviceInfo">
        <div class="device-name">
            <span class="device-icon"><i class="fa-solid fa-laptop"></i></span>
            <span id="deviceName">Loading...</span>
        </div>
        <div class="managed-by" id="managedBy">Detecting management...</div>
    </div>

    <!-- Status Bar (Clock & Battery) -->
    <div id="statusBar">
        <div id="clock"></div>
        <div id="batteryWidget">
            <i id="batteryIcon" class="fa-solid fa-battery-full"></i>
            <span id="batteryLevel">100%</span>
            <i id="batteryChargingIcon" class="fa-solid fa-bolt" style="display: none;"></i>
        </div>
    </div>

    <!-- Key Input Modal -->
    <div class="key-modal" id="keyModal">
        <div class="key-modal-content">
            <h2>Enter Access Key</h2>
            <input type="text" class="key-input" id="keyInput" placeholder="Enter key...">
            <div class="key-error" id="keyError"></div>
            <div>
                <button class="key-submit" onclick="submitKey()">Submit</button>
                <button class="key-cancel" onclick="closeKeyModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Game Loading Overlay -->
    <div id="game-loader">
        <div class="spinner"></div>
        <div class="loading-text">Loading game...</div>
        <div class="bible-verse" id="bibleVerse">
            <div class="verse-text" id="verseText"></div>
            <div class="verse-reference" id="verseReference"></div>
        </div>
    </div>

    <!-- Game Container -->
    <div id="game-container">
        <div class="game-header">
            <div class="game-title" id="currentGameTitle">Game</div>
            <div class="header-buttons">
                <button class="control-btn" id="fullscreenBtn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
                <button class="control-btn" onclick="reloadGame()">üîÑ Reload</button>
                <button class="control-btn" onclick="closeGame()">‚úñ Close</button>
            </div>
        </div>
        <iframe id="game-frame"></iframe>
    </div>

    <!-- Fullscreen hint -->
    <div class="fullscreen-hint" id="fullscreenHint">Press ESC to exit fullscreen</div>

    <script>
        // ---------- Theme Data ----------
        const themes = {
            "midnight_blossom": {"bg":"#1a1023","header":"#2a1738","text":"#f8eaff","muted":"#d7c6e6","accent":"#ff7bda","accentDark":"#b30088","glowColor":"#ffb3ef","cardBg":"#261332","cardRadius":12,"glowSize":28,"glowStrength":0.55,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ffcdf5","snowCount":130,"snowSize":3,"snowSpeed":1.4},
            "emerald_peak": {"bg":"#051914","header":"#0b2c22","text":"#dcfff5","muted":"#b9e6d2","accent":"#4cffc1","accentDark":"#158f6b","glowColor":"#77ffd9","cardBg":"#0f3b2c","cardRadius":14,"glowSize":22,"glowStrength":0.4,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#a8ffe5","snowCount":110,"snowSize":3,"snowSpeed":1.2},
            "solar_flare": {"bg":"#2a0b00","header":"#4d1300","text":"#ffe6d4","muted":"#ffc4a1","accent":"#ff5e00","accentDark":"#a63500","glowColor":"#ff9e66","cardBg":"#3b0f00","cardRadius":10,"glowSize":33,"glowStrength":0.6,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ff7033","snowCount":85,"snowSize":4,"snowSpeed":1.7},
            "frostbyte": {"bg":"#02131e","header":"#062738","text":"#ddf7ff","muted":"#b8e5f2","accent":"#52d7ff","accentDark":"#1e7da3","glowColor":"#b8f5ff","cardBg":"#0a2c40","cardRadius":18,"glowSize":25,"glowStrength":0.52,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#cff7ff","snowCount":200,"snowSize":2,"snowSpeed":1.1},
            "bubblegum_dream": {"bg":"#ffdef2","header":"#ffd1ee","text":"#5e004a","muted":"#8a006b","accent":"#ff77cf","accentDark":"#d1008d","glowColor":"#ffb0e8","cardBg":"#ffd8ef","cardRadius":20,"glowSize":20,"glowStrength":0.4,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ff87d9","snowCount":50,"snowSize":5,"snowSpeed":0.8},
            "radioactive_neon": {"bg":"#031301","header":"#062705","text":"#dfffda","muted":"#b9e6bc","accent":"#39ff14","accentDark":"#1faf08","glowColor":"#7dff67","cardBg":"#0b3d09","cardRadius":10,"glowSize":40,"glowStrength":0.9,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#7fff52","snowCount":150,"snowSize":3,"snowSpeed":1.6},
            "sunset_sorbet": {"bg":"#3b0f1c","header":"#5c1830","text":"#ffeef5","muted":"#ffbfd5","accent":"#ff668f","accentDark":"#b33252","glowColor":"#ff9cb5","cardBg":"#471427","cardRadius":15,"glowSize":30,"glowStrength":0.5,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ffb6ce","snowCount":120,"snowSize":3,"snowSpeed":1.3},
            "cafe_mocha": {"bg":"#2a1a10","header":"#3b2415","text":"#ffe8d8","muted":"#d9c3b5","accent":"#b87445","accentDark":"#7c4c2d","glowColor":"#d8a986","cardBg":"#351f13","cardRadius":12,"glowSize":18,"glowStrength":0.38,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#c59c7a","snowCount":60,"snowSize":4,"snowSpeed":0.9},
            "aqua_wave": {"bg":"#001a26","header":"#003344","text":"#dcf8ff","muted":"#b9e6f2","accent":"#3ddcff","accentDark":"#117d99","glowColor":"#8af0ff","cardBg":"#002a38","cardRadius":16,"glowSize":26,"glowStrength":0.58,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#a8f6ff","snowCount":140,"snowSize":3,"snowSpeed":1.4},
            "moonlight_silver": {"bg":"#0f0f14","header":"#1a1a22","text":"#f2f2f6","muted":"#bcbcc6","accent":"#9ea4ff","accentDark":"#5056c8","glowColor":"#c4c7ff","cardBg":"#16161d","cardRadius":12,"glowSize":28,"glowStrength":0.5,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#d3d6ff","snowCount":120,"snowSize":3,"snowSpeed":1.2},
            "jungle_mist": {"bg":"#0b1f12","header":"#153423","text":"#e8ffe8","muted":"#cceccc","accent":"#66ff8c","accentDark":"#27994a","glowColor":"#99ffc0","cardBg":"#102a1a","cardRadius":14,"glowSize":22,"glowStrength":0.43,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#b6ffd2","snowCount":90,"snowSize":3,"snowSpeed":1.3},
            "ocean_dusk": {"bg":"#001224","header":"#002544","text":"#dff2ff","muted":"#b8d7e6","accent":"#6cb8ff","accentDark":"#2c6ba3","glowColor":"#a3d7ff","cardBg":"#001d33","cardRadius":18,"glowSize":24,"glowStrength":0.45,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#bcdfff","snowCount":160,"snowSize":2,"snowSpeed":1.1},
            "pink_frost": {"bg":"#2b0d1f","header":"#471634","text":"#ffdff5","muted":"#f1b9d8","accent":"#ff7ec4","accentDark":"#b24284","glowColor":"#ffb2dc","cardBg":"#3b122a","cardRadius":16,"glowSize":34,"glowStrength":0.6,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ffc2e6","snowCount":150,"snowSize":3,"snowSpeed":1.5},
            "techno_grid": {"bg":"#0a0a0f","header":"#15151f","text":"#e3e9ff","muted":"#b7c0e6","accent":"#40bbff","accentDark":"#1778a3","glowColor":"#89d8ff","cardBg":"#12121a","cardRadius":12,"glowSize":36,"glowStrength":0.75,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#66ccff","snowCount":180,"snowSize":3,"snowSpeed":1.6},
            "sunny_field": {"bg":"#fff8d9","header":"#ffeeb3","text":"#663e00","muted":"#8c5c1a","accent":"#ffcc33","accentDark":"#c78a00","glowColor":"#ffe57a","cardBg":"#fff1bf","cardRadius":20,"glowSize":20,"glowStrength":0.35,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ffe28a","snowCount":50,"snowSize":4,"snowSpeed":0.9},
            "mint_leaf": {"bg":"#e6fff4","header":"#c6ffe6","text":"#004d33","muted":"#267359","accent":"#33ffb8","accentDark":"#0fa36e","glowColor":"#8cffd7","cardBg":"#d2ffe8","cardRadius":18,"glowSize":18,"glowStrength":0.32,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#a0ffe6","snowCount":40,"snowSize":5,"snowSpeed":0.7},
            "void_shadow": {"bg":"#000000","header":"#0a0a0a","text":"#e6e6e6","muted":"#999999","accent":"#5a5a5a","accentDark":"#2a2a2a","glowColor":"#bbbbbb","cardBg":"#080808","cardRadius":10,"glowSize":40,"glowStrength":0.8,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#cccccc","snowCount":200,"snowSize":2,"snowSpeed":1.2},
            "ruby_crystal": {"bg":"#290001","header":"#400002","text":"#ffe5e8","muted":"#ffb3bb","accent":"#ff3355","accentDark":"#a30024","glowColor":"#ff8899","cardBg":"#320002","cardRadius":14,"glowSize":32,"glowStrength":0.6,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ff99aa","snowCount":130,"snowSize":3,"snowSpeed":1.6},
            "arctic_bloom": {"bg":"#f2fcff","header":"#dff8ff","text":"#004f63","muted":"#1b6e84","accent":"#53dfff","accentDark":"#0c8ba3","glowColor":"#9eeeff","cardBg":"#e7f9ff","cardRadius":18,"glowSize":18,"glowStrength":0.3,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#bbf2ff","snowCount":60,"snowSize":4,"snowSpeed":0.9},
            "honey_glow": {"bg":"#2a1900","header":"#412600","text":"#ffefcc","muted":"#ddc7a1","accent":"#ffb300","accentDark":"#a67300","glowColor":"#ffd677","cardBg":"#352000","cardRadius":12,"glowSize":26,"glowStrength":0.46,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ffcf87","snowCount":100,"snowSize":3,"snowSpeed":1.2},
            "acid_punch": {"bg":"#12001a","header":"#260033","text":"#ffe6ff","muted":"#d9b3e6","accent":"#ff00cc","accentDark":"#99007a","glowColor":"#ff80dd","cardBg":"#1c0026","cardRadius":16,"glowSize":38,"glowStrength":0.72,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ffaae8","snowCount":150,"snowSize":3,"snowSpeed":1.5},
            "arctic_night": {"bg":"#06080f","header":"#0b1120","text":"#dde6ff","muted":"#a7b4d9","accent":"#5577ff","accentDark":"#2a3c99","glowColor":"#9bb5ff","cardBg":"#090d14","cardRadius":10,"glowSize":27,"glowStrength":0.55,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#c3d2ff","snowCount":170,"snowSize":3,"snowSpeed":1.4},
            "rainforest_dew": {"bg":"#0d1f17","header":"#123026","text":"#e0fff3","muted":"#bee6d8","accent":"#4cffac","accentDark":"#1d8f64","glowColor":"#92ffd3","cardBg":"#102a20","cardRadius":14,"glowSize":24,"glowStrength":0.42,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#b6ffe1","snowCount":100,"snowSize":3,"snowSpeed":1.2},
            "candy_arcade": {"bg":"#230011","header":"#3b001b","text":"#ffebf3","muted":"#ffc4db","accent":"#ff4fa4","accentDark":"#a30062","glowColor":"#ff9bcf","cardBg":"#310016","cardRadius":18,"glowSize":36,"glowStrength":0.7,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#ffb4da","snowCount":140,"snowSize":3,"snowSpeed":1.5},
            "obsidian_gold": {"bg":"#0a0905","header":"#1a180f","text":"#f7e7bf","muted":"#d4c193","accent":"#e6b400","accentDark":"#9c7d00","glowColor":"#ffe680","cardBg":"#12110a","cardRadius":12,"glowSize":28,"glowStrength":0.55,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#f5d97c","snowCount":100,"snowSize":3,"snowSpeed":1.3},
            "glacial_berry": {"bg":"#1e0033","header":"#32004f","text":"#f4e6ff","muted":"#d4b3f7","accent":"#bf59ff","accentDark":"#7826a6","glowColor":"#d9a3ff","cardBg":"#290041","cardRadius":15,"glowSize":33,"glowStrength":0.6,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#e7c3ff","snowCount":145,"snowSize":3,"snowSpeed":1.5},
            "lavender_fade": {"bg":"#f4edff","header":"#e9ddff","text":"#3b2b66","muted":"#695a91","accent":"#b899ff","accentDark":"#6f59b3","glowColor":"#d2c2ff","cardBg":"#ede3ff","cardRadius":20,"glowSize":20,"glowStrength":0.33,"fontFamily":"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif","snowColor":"#d8caff","snowCount":60,"snowSize":4,"snowSpeed":0.8}
        };

        let currentTheme = localStorage.getItem('selectedTheme') || 'midnight_blossom';
        let teacherLinkUrl = localStorage.getItem('teacherLinkUrl') || 'https://classroom.google.com';

        // ---------- Teacher Link Functions ----------
        function saveTeacherLink() {
            const input = document.getElementById('teacherLinkInput');
            const link = document.getElementById('teacherLink');
            const url = input.value.trim();

            if (url === '') {
                alert('Please enter a valid URL');
                return;
            }

            // Add https:// if not present
            let finalUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                finalUrl = 'https://' + url;
            }

            teacherLinkUrl = finalUrl;
            localStorage.setItem('teacherLinkUrl', finalUrl);
            link.href = finalUrl;
            
            alert('Link saved successfully! ‚úì');
        }

        function loadTeacherLink() {
            const input = document.getElementById('teacherLinkInput');
            const link = document.getElementById('teacherLink');
            
            if (input) input.value = teacherLinkUrl;
            if (link) link.href = teacherLinkUrl;
        }

        // ---------- Theme Functions ----------
        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;

            const root = document.documentElement;
            root.style.setProperty('--bg', theme.bg);
            root.style.setProperty('--header', theme.header);
            root.style.setProperty('--text', theme.text);
            root.style.setProperty('--muted', theme.muted);
            root.style.setProperty('--accent', theme.accent);
            root.style.setProperty('--accentDark', theme.accentDark);
            root.style.setProperty('--glowColor', theme.glowColor);
            root.style.setProperty('--cardBg', theme.cardBg);
            root.style.setProperty('--cardRadius', theme.cardRadius + 'px');
            root.style.setProperty('--glowSize', theme.glowSize + 'px');
            root.style.setProperty('--glowStrength', theme.glowStrength);
            root.style.setProperty('--fontFamily', theme.fontFamily);
            root.style.setProperty('--snowColor', theme.snowColor);

            // Update snow config
            snowConfig.color = theme.snowColor;
            snowConfig.count = theme.snowCount;
            snowConfig.size = theme.snowSize;
            snowConfig.speed = theme.snowSpeed;

            currentTheme = themeName;
            localStorage.setItem('selectedTheme', themeName);

            // Update theme grid selection
            updateThemeSelection();
        }

        function updateThemeSelection() {
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.theme === currentTheme) {
                    opt.classList.add('selected');
                }
            });
        }

        function renderThemeGrid() {
            const grid = document.getElementById('themeGrid');
            grid.innerHTML = Object.keys(themes).map(key => {
                const displayName = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                return `<div class="theme-option ${key === currentTheme ? 'selected' : ''}" data-theme="${key}" onclick="applyTheme('${key}')">
                    ${displayName}
                </div>`;
            }).join('');
        }

        // ----------  Snow Effect ----------
        var canvas = document.getElementById("snowCanvas");
        var ctx = canvas.getContext("2d");
        var snowflakes = [];
        var snowConfig = {
            count: 150,
            size: 3,
            speed: 1.2,
            color: "#ffffff"
        };

        function resizeCanvas() {
            canvas.width = innerWidth;
            canvas.height = innerHeight;
        }
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        function createSnow(count, size) {
            snowflakes = [];
            for (var i = 0; i < count; i++) {
                snowflakes.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    r: Math.random() * size + 0.5,
                    d: Math.random() * 1.5 + 0.2,
                    sway: Math.random() * 2 * Math.PI,
                    swayAmp: Math.random() * 20
                });
            }
        }

        function hexToRGBA(hex, alpha) {
            alpha = alpha || 1;
            if (!hex) return "rgba(255,255,255," + alpha + ")";
            var h = hex.replace("#", "");
            var num = parseInt(h, 16);
            var r = (num >> 16) & 255;
            var g = (num >> 8) & 255;
            var b = num & 255;
            return "rgba(" + r + "," + g + "," + b + "," + alpha + ")";
        }

        function drawSnow() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.fillStyle = hexToRGBA(snowConfig.color || "#ffffff", 0.95);

            if (snowflakes.length !== snowConfig.count) {
                createSnow(snowConfig.count, snowConfig.size);
            }

            for (var i = 0; i < snowflakes.length; i++) {
                var flake = snowflakes[i];
                ctx.moveTo(flake.x, flake.y);
                ctx.arc(flake.x, flake.y, flake.r, 0, Math.PI * 2);
                flake.y += flake.d * snowConfig.speed;
                flake.sway += 0.01 + Math.random() * 0.02;
                flake.x += Math.sin(flake.sway) * 0.6;

                if (flake.y > canvas.height + 20) {
                    flake.x = Math.random() * canvas.width;
                    flake.y = -10 - Math.random() * 40;
                }
                if (flake.x > canvas.width + 50) flake.x = -20;
                if (flake.x < -50) flake.x = canvas.width + 20;
            }
            ctx.fill();
            requestAnimationFrame(drawSnow);
        }

        createSnow(snowConfig.count, snowConfig.size);
        drawSnow();

        // ----------  Device Information ----------
        function getDeviceName() {
            const platform = navigator.platform || 'Unknown';
            const userAgent = navigator.userAgent;
            
            let deviceName = '';
            
            if (userAgent.includes('CrOS')) {
                const match = userAgent.match(/CrOS\s+\w+\s+([\w-]+)/);
                if (match) {
                    deviceName = 'Chromebook-' + match[1];
                } else {
                    deviceName = 'Chromebook';
                }
            } else if (platform.includes('Win')) {
                deviceName = 'Windows-PC';
            } else if (platform.includes('Mac')) {
                const isMobile = /iPhone|iPad|iPod/.test(userAgent);
                deviceName = isMobile ? 'iPad/iPhone' : 'MacBook';
            } else if (platform.includes('Linux')) {
                if (userAgent.includes('Android')) {
                    deviceName = 'Android-Device';
                } else {
                    deviceName = 'Linux-PC';
                }
            } else {
                deviceName = 'Unknown-Device';
            }
            
            return deviceName;
        }

        async function detectManagement() {
            const userAgent = navigator.userAgent;
            
            if (userAgent.includes('CrOS')) {
                return 'Managed by School';
            } else if (navigator.managed) {
                return 'Managed by Organization';
            } else {
                return 'Personal Device';
            }
        }

        async function updateDeviceInfo() {
            const deviceNameEl = document.getElementById('deviceName');
            const managedByEl = document.getElementById('managedBy');
            
            if (deviceNameEl && managedByEl) {
                const deviceName = getDeviceName();
                const managedInfo = await detectManagement();
                
                deviceNameEl.textContent = deviceName;
                managedByEl.textContent = managedInfo;
            }
        }

        updateDeviceInfo();

        // ----------  Bible Verses ----------
        const bibleVerses = [
            { ref: "John 3:16", text: "For God so loved the world that He gave His only begotten Son, that whoever believes in Him should not perish but have everlasting life." },
            { ref: "Romans 5:8", text: "But God demonstrates His own love toward us, in that while we were still sinners, Christ died for us." },
            { ref: "Ephesians 2:8-9", text: "For by grace you have been saved through faith, and that not of yourselves; it is the gift of God, not of works, lest anyone should boast." },
            { ref: "Philippians 4:13", text: "I can do all things through Christ who strengthens me." },
            { ref: "Isaiah 40:31", text: "But those who wait on the LORD shall renew their strength; they shall mount up with wings like eagles, they shall run and not be weary, they shall walk and not faint." },
            { ref: "Romans 8:28", text: "And we know that all things work together for good to those who love God, to those who are the called according to His purpose." },
            { ref: "Psalm 23:4", text: "Yea, though I walk through the valley of the shadow of death, I will fear no evil; for You are with me; Your rod and Your staff, they comfort me." },
            { ref: "Joshua 1:9", text: "Have I not commanded you? Be strong and of good courage; do not be afraid, nor be dismayed, for the LORD your God is with you wherever you go." },
            { ref: "Proverbs 3:5-6", text: "Trust in the LORD with all your heart, and lean not on your own understanding; in all your ways acknowledge Him, and He shall direct your paths." },
            { ref: "Matthew 6:33", text: "But seek first the kingdom of God and His righteousness, and all these things shall be added to you." },
            { ref: "Jeremiah 29:11", text: "For I know the thoughts that I think toward you, says the LORD, thoughts of peace and not of evil, to give you a future and a hope." },
            { ref: "Psalm 46:1", text: "God is our refuge and strength, a very present help in trouble." },
            { ref: "John 14:6", text: "Jesus said to him, 'I am the way, the truth, and the life. No one comes to the Father except through Me.'" },
            { ref: "Romans 8:38-39", text: "For I am persuaded that neither death nor life, nor angels nor principalities nor powers, nor things present nor things to come, nor height nor depth, nor any other created thing, shall be able to separate us from the love of God which is in Christ Jesus our Lord." },
            { ref: "Psalm 119:105", text: "Your word is a lamp to my feet and a light to my path." },
            { ref: "Matthew 11:28", text: "Come to Me, all you who labor and are heavy laden, and I will give you rest." },
            { ref: "Isaiah 41:10", text: "Fear not, for I am with you; be not dismayed, for I am your God. I will strengthen you, yes, I will help you, I will uphold you with My righteous right hand." },
            { ref: "Philippians 4:6-7", text: "Be anxious for nothing, but in everything by prayer and supplication, with thanksgiving, let your requests be made known to God; and the peace of God, which surpasses all understanding, will guard your hearts and minds through Christ Jesus." },
            { ref: "1 John 4:8", text: "He who does not love does not know God, for God is love." },
            { ref: "Hebrews 13:8", text: "Jesus Christ is the same yesterday, today, and forever." }
        ];

        function getRandomVerse() {
            return bibleVerses[Math.floor(Math.random() * bibleVerses.length)];
        }

        // ----------  GitHub configuration ----------
        const GITHUB_USER = 'Monkevrr';
        const GITHUB_REPO = 'Html';
        const GITHUB_BRANCH = 'main';

        let games = [];
        let proxies = [];
        let currentGame = { filename: '', title: '' };
        let proxyUnlocked = localStorage.getItem('proxyUnlocked') === 'true';

        // ----------  Clock ----------
        function updateClock() {
            const now = new Date();
            let h = now.getHours();
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            document.getElementById('clock').textContent = `${h}:${m}:${s} ${ampm}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // ----------  Battery Status ----------
        async function updateBatteryStatus() {
            var widget = document.getElementById("batteryWidget");
            if (!widget) return;
            
            if ("getBattery" in navigator) {
                try {
                    var battery = await navigator.getBattery();
                    var updateAll = function() {
                        var level = Math.round(battery.level * 100);
                        var batteryLevel = document.getElementById("batteryLevel");
                        var batteryChargingIcon = document.getElementById("batteryChargingIcon");
                        var batteryIcon = document.getElementById("batteryIcon");
                        
                        if (batteryLevel) batteryLevel.textContent = level + "%";
                        if (batteryChargingIcon) batteryChargingIcon.style.display = battery.charging ? "inline-block" : "none";
                        
                        if (batteryIcon) {
                            if (battery.charging) batteryIcon.className = "fa-solid fa-battery-full";
                            else if (level > 85) batteryIcon.className = "fa-solid fa-battery-full";
                            else if (level > 60) batteryIcon.className = "fa-solid fa-battery-three-quarters";
                            else if (level > 35) batteryIcon.className = "fa-solid fa-battery-half";
                            else if (level > 10) batteryIcon.className = "fa-solid fa-battery-quarter";
                            else batteryIcon.className = "fa-solid fa-battery-empty";
                        }
                    };
                    updateAll();
                    battery.addEventListener("levelchange", updateAll);
                    battery.addEventListener("chargingchange", updateAll);
                } catch (e) {
                    widget.style.display = "none";
                }
            } else {
                widget.style.display = "none";
            }
        }
        updateBatteryStatus();

        // ----------  Keyboard Shortcuts ----------
        document.addEventListener('keydown', function(e) {
            // Ctrl + 1 for teacher link
            if (e.ctrlKey && e.key === '1') {
                e.preventDefault();
                window.open(teacherLinkUrl, '_blank');
            }

            // ESC to close game
            if (e.key === 'Escape' && !document.fullscreenElement &&
                !document.webkitFullscreenElement && !document.mozFullScreenElement &&
                !document.msFullscreenElement) {
                closeGame();
            }
        });

        // ----------  Sidebar navigation ----------
        function switchSection(section) {
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
            if (section === 'games') {
                document.getElementById('gamesSection').classList.add('active');
            } else if (section === 'proxys') {
                document.getElementById('proxysSection').classList.add('active');
            } else if (section === 'settings') {
                document.getElementById('settingsSection').classList.add('active');
            }
        }

        // ----------  Proxy access ----------
        function checkProxyAccess() {
            if (proxyUnlocked) {
                switchSection('proxys');
            } else {
                document.getElementById('keyModal').classList.add('show');
                document.getElementById('keyError').textContent = '';
                document.getElementById('keyInput').focus();
            }
        }

        function submitKey() {
            const key = document.getElementById('keyInput').value.trim();
            const err = document.getElementById('keyError');

            if (key === 'Lebron') {
                proxyUnlocked = true;
                localStorage.setItem('proxyUnlocked', 'true');
                unlockProxy();
                closeKeyModal();
                switchSection('proxys');
            } else {
                err.textContent = 'Incorrect key! Try again.';
                document.getElementById('keyInput').value = '';
            }
        }

        function unlockProxy() {
            const item = document.getElementById('proxysItem');
            item.classList.remove('locked');
            item.querySelector('.lock-icon').textContent = 'üîì';
        }

        function closeKeyModal() {
            document.getElementById('keyModal').classList.remove('show');
        }

        document.getElementById('keyInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') submitKey();
        });

        // ----------  Data fetching ----------
        async function fetchGames() {
            const api = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/git/trees/${GITHUB_BRANCH}?recursive=1`;
            const res = await fetch(api);

            if (!res.ok) throw new Error(`GitHub API error ${res.status}`);

            const data = await res.json();
            games = data.tree
                .filter(f => f.path.endsWith('.html') && f.type === 'blob' && !f.path.includes('prox/'))
                .map(f => ({
                    filename: f.path,
                    name: formatGameName(f.path)
                }));
            return games;
        }

        async function fetchProxies() {
            const api = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/prox?ref=${GITHUB_BRANCH}`;
            const res = await fetch(api);

            if (!res.ok) throw new Error(`GitHub API error ${res.status}`);

            const data = await res.json();
            proxies = data
                .filter(f => f.name.endsWith('.html') && f.type === 'file')
                .map(f => ({
                    filename: f.name,
                    path: f.path,
                    name: formatProxyName(f.name)
                }));
            return proxies;
        }

        function formatGameName(path) {
            let name = path.replace('.html', '');
            name = name.replace('view-page-source.com-', '');
            name = name.replace(/_/g, ' ').replace(/-/g, ' ');
            name = name.replace('.itch.io', '');
            return name.split(' ')
                .map(w => w.charAt(0).toUpperCase() + w.slice(1))
                .join(' ');
        }

        function formatProxyName(name) {
            name = name.replace('.html', '');
            name = name.replace(/_/g, ' ').replace(/-/g, ' ');
            return name.split(' ')
                .map(w => w.charAt(0).toUpperCase() + w.slice(1))
                .join(' ');
        }

        // ----------  UI rendering ----------
        function renderGameButtons() {
            const container = document.getElementById('gameButtons');
            if (games.length === 0) {
                container.innerHTML = '<p style="color:#666;">No games found.</p>';
                return;
            }
            container.innerHTML = games.map(g => `
                <button class="game-button" onclick="loadGame('${g.filename}', '${g.name}')">
                    <span>${g.name}</span>
                </button>`).join('');
        }

        async function renderProxyItems() {
            const container = document.getElementById('proxyList');
            try {
                await fetchProxies();
                if (proxies.length === 0) {
                    container.innerHTML = '<p style="color:#666;text-align:center;">No proxy files found.</p>';
                    return;
                }
                container.innerHTML = proxies.map(p => `
                    <div class="proxy-item" onclick="loadProxy('${p.path}', '${p.name}')">
                        ${p.name}
                    </div>`).join('');
            } catch (e) {
                console.error(e);
                container.innerHTML = '<p style="color:#ff0000;text-align:center;">Failed to load proxies.</p>';
            }
        }

        // ----------  Game loading ----------
        function loadGame(filename, title) {
            currentGame = { filename, title };
            const loader = document.getElementById('game-loader');
            const container = document.getElementById('game-container');
            const frame = document.getElementById('game-frame');
            const gameTitle = document.getElementById('currentGameTitle');

            // Display random Bible verse
            const verse = getRandomVerse();
            document.getElementById('verseText').textContent = `"${verse.text}"`;
            document.getElementById('verseReference').textContent = `- ${verse.ref}`;

            const url = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/${filename}`;

            loader.style.display = 'flex';
            container.style.display = 'none';

            fetch(`${url}?t=${Date.now()}`)
                .then(r => {
                    if (!r.ok) throw new Error(`HTTP ${r.status}`);
                    return r.text();
                })
                .then(html => {
                    // Changed from 1000ms to 5000ms (5 seconds) so people can read the verse
                    setTimeout(() => {
                        gameTitle.textContent = title;
                        frame.srcdoc = html;
                        loader.style.display = 'none';
                        container.style.display = 'flex';
                    }, 5000);
                })
                .catch(err => {
                    loader.style.display = 'none';
                    alert('Failed to load game: ' + err.message);
                    console.error(err);
                });
        }

        function loadProxy(filepath, title) {
            currentGame = { filename: filepath, title };
            const loader = document.getElementById('game-loader');
            const container = document.getElementById('game-container');
            const frame = document.getElementById('game-frame');
            const gameTitle = document.getElementById('currentGameTitle');

            // Display random Bible verse
            const verse = getRandomVerse();
            document.getElementById('verseText').textContent = `"${verse.text}"`;
            document.getElementById('verseReference').textContent = `- ${verse.ref}`;

            const url = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/${filepath}`;

            loader.style.display = 'flex';
            container.style.display = 'none';

            fetch(`${url}?t=${Date.now()}`)
                .then(r => {
                    if (!r.ok) throw new Error(`HTTP ${r.status}`);
                    return r.text();
                })
                .then(html => {
                    // Changed from 1000ms to 5000ms (5 seconds) so people can read the verse
                    setTimeout(() => {
                        gameTitle.textContent = title;
                        frame.srcdoc = html;
                        loader.style.display = 'none';
                        container.style.display = 'flex';
                    }, 5000);
                })
                .catch(err => {
                    loader.style.display = 'none';
                    alert('Failed to load proxy: ' + err.message);
                    console.error(err);
                });
        }

        function reloadGame() {
            if (currentGame.filename) {
                if (currentGame.filename.includes('prox/')) {
                    loadProxy(currentGame.filename, currentGame.title);
                } else {
                    loadGame(currentGame.filename, currentGame.title);
                }
            }
        }

        function toggleFullscreen() {
            const gameContainer = document.getElementById('game-container');
            const btn = document.getElementById('fullscreenBtn');
            const hint = document.getElementById('fullscreenHint');

            if (!document.fullscreenElement && !document.webkitFullscreenElement &&
                !document.mozFullScreenElement && !document.msFullscreenElement) {
                if (gameContainer.requestFullscreen) gameContainer.requestFullscreen();
                else if (gameContainer.webkitRequestFullscreen) gameContainer.webkitRequestFullscreen();
                else if (gameContainer.mozRequestFullScreen) gameContainer.mozRequestFullScreen();
                else if (gameContainer.msRequestFullscreen) gameContainer.msRequestFullscreen();

                btn.textContent = '‚õ∂ Exit Fullscreen';
                hint.classList.add('show');
                setTimeout(() => hint.classList.remove('show'), 3000);
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();

                btn.textContent = '‚õ∂ Fullscreen';
            }
        }

        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('mozfullscreenchange', updateFullscreenButton);
        document.addEventListener('MSFullscreenChange', updateFullscreenButton);

        function updateFullscreenButton() {
            const btn = document.getElementById('fullscreenBtn');
            const inFull = document.fullscreenElement || document.webkitFullscreenElement ||
                            document.mozFullScreenElement || document.msFullscreenElement;
            btn.textContent = inFull ? '‚õ∂ Exit Fullscreen' : '‚õ∂ Fullscreen';
        }

        function closeGame() {
            if (document.fullscreenElement || document.webkitFullscreenElement ||
                document.mozFullScreenElement || document.msFullscreenElement) {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();
            }

            document.getElementById('game-container').style.display = 'none';
            document.getElementById('game-frame').srcdoc = '';
            currentGame = { filename: '', title: '' };
        }

        // ----------  Initialization ----------
        async function initializeLauncher() {
            const loader = document.getElementById('initial-loader');
            const main = document.getElementById('main-content');
            const gameCount = document.getElementById('gameCount');
            const loadingText = loader.querySelector('.loading-text');

            // Apply saved theme
            applyTheme(currentTheme);
            renderThemeGrid();

            try {
                await fetchGames();
                gameCount.textContent = `${games.length} Games Found!`;
                loadingText.textContent = 'Loading games...';

                setTimeout(() => {
                    renderGameButtons();
                    loader.style.display = 'none';
                    main.style.display = 'block';
                }, 1500);
            } catch (e) {
                loadingText.textContent = 'Error loading games';
                gameCount.innerHTML = '<span style="color:#ff0000;">Failed to connect to GitHub</span>';
                console.error(e);
                setTimeout(() => {
                    if (confirm('Failed to load games from GitHub. Retry?')) location.reload();
                }, 2000);
            }
        }

        document.getElementById('proxysItem').addEventListener('click', () => {
            if (proxyUnlocked) renderProxyItems();
        });

        if (proxyUnlocked) unlockProxy();

        initializeLauncher();
    </script>
</body>
</html>
